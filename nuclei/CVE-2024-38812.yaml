id: CVE-2024-38812
info:
  name: VMware vCenter Server Heap Overflow
  author: Ostorlab Team
  severity: critical
  description: The vCenter Server contains a heap-overflow vulnerability in the implementation of the DCERPC protocol. A malicious actor with network access to vCenter Server may trigger this vulnerability by sending a specially crafted network packet potentially leading to remote code execution.
  reference:
    - https://support.broadcom.com/web/ecx/support-content-notification/-/external/content/SecurityAdvisories/0/24968
    - https://nvd.nist.gov/vuln/detail/CVE-2024-38812
  classification:
    cwe-id: CWE-122
  metadata:
    shodan-query: 'product:"VMware vCenter Server"'
  tags: overflow,vmware,vcenter,rce
http:
  - method: POST
    path:
      - '{{BaseURL}}/sdk'
    body: |
      <soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
        <soap:Body>
          <RetrieveServiceContent xmlns="urn:vim25">
            <_this type="ServiceInstance">ServiceInstance</_this>
          </RetrieveServiceContent>
        </soap:Body>
      </soap:Envelope>
    extractors:
      - type: regex
        part: body
        name: version
        group: 1
        regex:
          - '<version>([^<]*)</version>'
      - type: regex
        part: body
        name: build
        group: 1
        regex:
          - '<build>([^<]*)</build>'
    matchers:
      # VMware vCenter Server 7.0 versions
      - type: dsl
        dsl:
          - compare_versions(version, ">=7.0", "<7.0.3")
          - compare_versions(build, "<24322018")
        condition: and
        name: vCenter70x_vulnerable_versions

      # VMware vCenter Server 8.0 versions
      - type: dsl
        dsl:
          - compare_versions(version, ">=8.0", "<8.0.3")
          - compare_versions(build, "<24554577")
        condition: and
        name: vCenter80x_vulnerable_versions