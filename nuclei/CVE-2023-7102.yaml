id: CVE-2023-7102

info:
  name: Barracuda ESG Appliance Remote Code Execution
  author: Mohamed Benchikh
  severity: critical
  description: |
    Barracuda Email Security Gateway (ESG) appliances are vulnerable to a remote code execution through a specially crafted Microsoft Excel attachement.
    In some cases it's not possible to extract the version of the Barracuda ESG appliance, therefore this template might miss some vulnerable instances.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-7102
    - https://thehackernews.com/2023/12/chinese-hackers-exploited-new-zero-day.html
    - https://www.barracuda.com/company/legal/esg-vulnerability
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-7102
    cwe-id: CWE-94,CWE-1104
  metadata:
    verified: true
    max-request: 2
    vendor: barracuda
    product: esg
    shodan-query: http.favicon.hash:1436966696
    fofa-query: app="Barracuda-Spam-Firewall"
  tags: cve-2023-7102,barracuda,rce,attachment

flow: http(1) || http(2)

http:
  - method: GET
    path:
      - "{{BaseURL}}/cgi-mod/view_help.cgi"

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "/css/help.css\\?v=([5-8]\\.[0-9]\\.[0-9]\\.?\\d{0,3}|9\\.1\\.[0-9]\\.?\\d{0,3}|9\\.2\\.0\\.?\\d{0,3})"

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - "/css/help.css\\?v=([5-8]\\.[0-9]\\.[0-9]\\.?\\d{0,3}|9\\.1\\.[0-9]\\.?\\d{0,3}|9\\.2\\.0\\.?\\d{0,3})"

  - method: GET
    path:
      - "{{BaseURL}}/cgi-mod/index.cgi"

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "bsvf/([5-8]\\.[0-9]\\.[0-9]\\.?\\d{0,3}|9\\.1\\.[0-9]\\.?\\d{0,3}|9\\.2\\.0\\.?\\d{0,3})/BsfOutlookAddIn.exe"

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - "/bsvf/([5-8]\\.[0-9]\\.[0-9]\\.?\\d{0,3}|9\\.1\\.[0-9]\\.?\\d{0,3}|9\\.2\\.0\\.?\\d{0,3})/BsfOutlookAddIn.exe"


